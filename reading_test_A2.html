<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Reading Practice – A2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;700;800&family=Questrial&display=swap" rel="stylesheet">
    <style>
        /* =====================================================================
           Organic Sage UI — Mobile-first, stable, and soothing
           Palette preserved; accessibility + mobile ergonomics improved.
           ===================================================================== */

        /* -------------------------------
           Design tokens
        ----------------------------------*/
        :root {
          /* Core palette (yours, kept) */
          --primary-sage: #7A8471;
          --secondary-sage: #9CAF88;
          --tertiary-sage: #B8C5A6;
          --warm-cream: #F8F6F0;
          --soft-white: #FEFCF7;
          --forest-shadow: #5A6B52;
          --border-sage: rgba(122, 132, 113, 0.20);
          --hover-sage: rgba(156, 175, 136, 0.15);

          /* Extended palette for depth */
          --deep-forest: #3E4A3A;
          --moss: #6E7A67;
          --fern: #8FA081;
          --dried-clay: #D9CDB4;
          --amber: #C6AA77;
          --ink: #2F3A2B;
          --ink-muted: #5A6B52;

          /* Typography */
          --font-display: 'Questrial', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, sans-serif;
          --font-body: 'Nunito', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, sans-serif;

          /* Fluid typography scale */
          --step--1: clamp(0.875rem, 0.84rem + 0.15vw, 0.95rem);
          --step-0:  clamp(1rem,     0.96rem + 0.22vw, 1.1rem);
          --step-1:  clamp(1.125rem, 1.07rem + 0.35vw, 1.3rem);
          --step-2:  clamp(1.375rem, 1.28rem + 0.55vw, 1.6rem);
          --step-3:  clamp(1.75rem,  1.58rem + 0.95vw, 2.1rem);
          --step-4:  clamp(2.25rem,  1.98rem + 1.35vw, 2.7rem);

          /* Rhythm */
          --space-1: 0.25rem;
          --space-2: 0.5rem;
          --space-3: 0.75rem;
          --space-4: 1rem;
          --space-5: 1.25rem;
          --space-6: 1.5rem;
          --space-7: 2rem;
          --space-8: 2.5rem;
          --space-9: 3rem;

          /* Shape + elevation */
          --radius-sm: 10px;
          --radius: 16px;
          --radius-lg: 20px;
          --radius-xl: 28px;

          --shadow-1: 0 1px 2px rgba(34, 41, 32, 0.05), 0 2px 8px rgba(34, 41, 32, 0.06);
          --shadow-2: 0 4px 18px rgba(34, 41, 32, 0.08), 0 12px 28px rgba(34, 41, 32, 0.06);
          --shadow-3: 0 10px 40px rgba(34, 41, 32, 0.10), 0 20px 60px rgba(34, 41, 32, 0.08);

          /* Focus ring (AA contrast on cream/white) */
          --ring: 0 0 0 3px color-mix(in oklab, var(--soft-white) 60%, transparent), 0 0 0 5px color-mix(in srgb, var(--secondary-sage), #2F3A2B 15%);

          /* Motion */
          --ease-ambient: cubic-bezier(.2,.8,.2,1);
          --dur-1: 120ms;
          --dur-2: 200ms;
          --dur-3: 320ms;

          /* Mobile-safe touch target */
          --target-min: 44px;

          /* Container max */
          --container-max: 900px;
        }

        /* -------------------------------
           Global reset / mobile stability
        ----------------------------------*/
        *,
        *::before,
        *::after {
          box-sizing: border-box;
        }

        html {
          -webkit-text-size-adjust: 100%; /* iOS font scaling fix */
          text-size-adjust: 100%;
          hanging-punctuation: first last;
        }

        html, body {
          margin: 0;
          padding: 0;
          width: 100%;
          min-height: 100dvh; /* mobile address bar safe */
          font-family: var(--font-body);
          font-size: var(--step-0);
          line-height: 1.6;
          color: var(--forest-shadow);
          background:
            radial-gradient(1200px 1200px at -10% -10%, #FFFFFF 0%, transparent 50%),
            radial-gradient(1200px 1000px at 110% 10%, #FFF8F0 0%, transparent 50%),
            linear-gradient(135deg, #F8F6F0 0%, #F5F3ED 100%);
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          overflow-x: hidden;
        }

        @media (prefers-reduced-motion: no-preference) {
          html { scroll-behavior: smooth; }
        }

        /* Better text wrapping on small screens */
        :where(p, h1, h2, h3, h4, h5, h6) {
          text-wrap: pretty;
          overflow-wrap: anywhere;
        }

        /* Media defaults */
        img, svg, video, canvas, audio, iframe {
          display: block;
          max-width: 100%;
          height: auto;
        }

        /* Links */
        a { color: var(--primary-sage); text-decoration-thickness: 1px; text-underline-offset: 2px; }
        a:hover { color: var(--deep-forest); }

        /* Utility: hide but readable for screen readers */
        .visually-hidden {
          position: absolute !important;
          height: 1px; width: 1px;
          overflow: hidden; clip: rect(1px, 1px, 1px, 1px);
          white-space: nowrap;
        }

        /* -------------------------------
           App shell
        ----------------------------------*/
        #app-wrapper {
          display: flex;
          justify-content: center;
          align-items: flex-start;
          padding: max(var(--space-7), env(safe-area-inset-top)) var(--space-4) var(--space-7);
          width: 100%;
          min-height: 100dvh;
          background:
            radial-gradient(800px 600px at 20% 0%, rgba(156,175,136,0.08) 0%, transparent 70%),
            radial-gradient(700px 500px at 80% 100%, rgba(90,107,82,0.06) 0%, transparent 65%);
        }

        /* Container gets subtle translucency on capable browsers */
        #activity-container {
          width: 100%;
          max-width: var(--container-max);
          background: color-mix(in srgb, var(--soft-white) 88%, white 12%);
          padding: clamp(24px, 3.2vw, 48px);
          border-radius: var(--radius-lg);
          border: 1px solid rgba(122, 132, 113, 0.12);
          box-shadow: var(--shadow-2);
          position: relative;
          isolation: isolate;
          container-type: inline-size; /* enables container queries where supported */
        }

        @supports (backdrop-filter: blur(6px)) {
          #activity-container {
            background: color-mix(in srgb, var(--soft-white) 76%, white 24%);
            backdrop-filter: blur(6px) saturate(1.02);
          }
        }

        /* Decorative organic edge glow (soft + subtle) */
        #activity-container::before {
          content: "";
          position: absolute;
          inset: -1px;
          border-radius: inherit;
          background:
            radial-gradient(1200px 200px at 50% -5%, rgba(156,175,136,0.12), transparent 60%),
            radial-gradient(800px 1000px at 50% 110%, rgba(122,132,113,0.08), transparent 70%);
          z-index: -1;
          pointer-events: none;
        }

        /* Hide screens when needed */
        .screen.hidden { display: none !important; }

        /* -------------------------------
           Headings / text
        ----------------------------------*/
        h1 {
          font-family: var(--font-display);
          font-size: var(--step-4);
          letter-spacing: 0.2px;
          color: var(--forest-shadow);
          margin: 0 0 var(--space-2) 0;
          text-align: center;
        }

        h2.rubric {
          font-family: var(--font-body);
          font-size: var(--step-0);
          font-weight: 500;
          color: var(--secondary-sage);
          margin: 0 0 var(--space-6) 0;
          text-align: center;
          line-height: 1.5;
        }

        h3 {
          font-family: var(--font-display);
          font-size: var(--step-2);
          color: var(--forest-shadow);
          margin: var(--space-6) 0 var(--space-3) 0;
        }

        /* -------------------------------
           Buttons
        ----------------------------------*/
        .activity-btn {
          min-height: var(--target-min);
          padding: 12px 20px;
          border-radius: 12px;
          border: 1px solid var(--primary-sage);
          background: linear-gradient(180deg, color-mix(in srgb, var(--primary-sage) 92%, white 8%), var(--primary-sage));
          color: #fff;
          font-weight: 700;
          font-size: 1rem;
          letter-spacing: 0.2px;
          cursor: pointer;
          text-decoration: none;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          gap: 0.5rem;
          -webkit-tap-highlight-color: transparent;
          touch-action: manipulation;
          user-select: none;
          transition: transform var(--dur-1) var(--ease-ambient), box-shadow var(--dur-2) var(--ease-ambient), background var(--dur-2) var(--ease-ambient), border-color var(--dur-2) var(--ease-ambient), opacity var(--dur-1) var(--ease-ambient);
          box-shadow: 0 1px 0 rgba(255,255,255,0.25) inset, 0 8px 16px rgba(90, 107, 82, 0.20);
        }

        .activity-btn:hover {
          background: linear-gradient(180deg, color-mix(in srgb, var(--forest-shadow) 92%, white 8%), var(--forest-shadow));
          transform: translateY(-1px);
          box-shadow: 0 1px 0 rgba(255,255,255,0.25) inset, 0 10px 20px rgba(90, 107, 82, 0.22);
        }

        .activity-btn:active {
          transform: translateY(0);
          box-shadow: 0 1px 0 rgba(255,255,255,0.2) inset, 0 4px 10px rgba(90, 107, 82, 0.20);
        }

        .activity-btn:focus-visible {
          outline: none;
          box-shadow: var(--ring), 0 8px 16px rgba(90, 107, 82, 0.20);
        }

        .activity-btn:disabled,
        .activity-btn[disabled] {
          background: var(--tertiary-sage);
          border-color: var(--tertiary-sage);
          color: color-mix(in srgb, #fff 70%, var(--soft-white) 30%);
          cursor: not-allowed;
          opacity: 0.8;
          transform: none;
          box-shadow: none;
        }

        /* Secondary variant */
        .activity-btn.secondary {
          background: transparent;
          color: var(--primary-sage);
          border-color: color-mix(in srgb, var(--tertiary-sage) 70%, var(--primary-sage) 30%);
          box-shadow: none;
        }

        .activity-btn.secondary:hover { background-color: var(--hover-sage); }

        .activity-btn.secondary:focus-visible {
          outline: none;
          box-shadow: var(--ring);
        }

        /* Button group alignment on small screens */
        .controls {
          margin-top: var(--space-7);
          text-align: center;
          display: grid;
          gap: var(--space-3);
          grid-auto-flow: row;
        }

        /* -------------------------------
           Forms / inputs
        ----------------------------------*/
        .input-group { margin: var(--space-6) 0; }

        .input-group label {
          display: block;
          font-weight: 700;
          margin-bottom: var(--space-2);
          color: var(--primary-sage);
          letter-spacing: 0.2px;
        }
        
        .fill-in-blank-input {
            width: 140px;
            display: inline-block;
            margin: 0 4px;
            padding: 4px 8px;
            font-size: 0.95rem;
            vertical-align: baseline;
        }

        input[type="text"],
        input[type="date"],
        textarea,
        select {
          width: 100%;
          min-height: var(--target-min);
          padding: 12px 14px;
          border-radius: 10px;
          border: 1px solid var(--tertiary-sage);
          background: #fff;
          font-size: 1rem;
          font-family: var(--font-body);
          color: var(--ink);
          box-shadow: 0 1px 0 rgba(255,255,255,0.6) inset;
          appearance: none;
          -webkit-appearance: none;
          transition: border-color var(--dur-2) var(--ease-ambient), box-shadow var(--dur-2) var(--ease-ambient), background var(--dur-2) var(--ease-ambient);
        }

        input::placeholder,
        textarea::placeholder {
          color: color-mix(in srgb, var(--ink-muted) 60%, #fff 40%);
          opacity: 0.9;
        }

        input:focus-visible,
        textarea:focus-visible,
        select:focus-visible {
          outline: none;
          border-color: var(--secondary-sage);
          box-shadow: var(--ring);
          background: color-mix(in srgb, #fff 92%, var(--warm-cream) 8%);
        }

        input:disabled,
        textarea:disabled,
        select:disabled {
          background: color-mix(in srgb, #fff 85%, var(--warm-cream) 15%);
          color: var(--ink-muted);
          cursor: not-allowed;
        }

        /* Date input caret/tap stability on iOS */
        input[type="date"] {
          -webkit-tap-highlight-color: transparent;
        }

        /* Textareas */
        textarea {
          resize: vertical;
        }

        /* Accent color for native radios/checkboxes (fallback when custom not active) */
        :root { accent-color: var(--primary-sage); }

        /* -------------------------------
           System Check Screen
        ----------------------------------*/
        .system-check-step { margin-bottom: var(--space-7); }

        #code-display-area {
          display: flex;
          align-items: center;
          gap: var(--space-3);
          margin-top: var(--space-3);
          flex-wrap: wrap; /* safer on mobile */
        }

        #generated-code {
          width: 100%;
          min-height: 100px;
          height: 120px;
          resize: vertical;
          font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace;
          font-size: 0.95rem;
          line-height: 1.45;
          padding: 12px 14px;
          border-radius: 10px;
          border: 1px solid var(--tertiary-sage);
          background: #fff;
          color: var(--ink);
        }

        #paste-target { margin-top: var(--space-3); }

        #paste-success-msg {
          color: #2E7D32;
          font-weight: 800;
          margin-top: var(--space-2);
        }

        /* -------------------------------
           Level Select Screen
        ----------------------------------*/
        .level-buttons {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
          gap: var(--space-4);
          margin-top: var(--space-7);
        }

        /* Nice tactile card-y buttons inside level grid (opt-in via .activity-btn) */
        .level-buttons .activity-btn {
          width: 100%;
        }

        /* -------------------------------
           Test Screen
        ----------------------------------*/
        .test-header {
          display: grid;
          grid-template-columns: auto 1fr auto;
          align-items: center;
          gap: var(--space-4);
          margin-bottom: var(--space-4);
          font-weight: 700;
        }

        #current-level { color: var(--secondary-sage); }
        #timer { font-size: 1.1rem; color: var(--primary-sage); text-align: right; }

        .progress-bar-container {
          width: 100%;
          height: 10px;
          background-color: var(--border-sage);
          border-radius: 999px;
          overflow: hidden;
        }

        #progress-bar {
          height: 100%;
          width: 0%;
          background: linear-gradient(90deg, var(--primary-sage), color-mix(in srgb, var(--secondary-sage) 60%, var(--primary-sage) 40%));
          transition: width var(--dur-3) var(--ease-ambient);
        }

        #progress-text {
          text-align: right;
          font-size: 0.9rem;
          color: var(--secondary-sage);
          margin-top: var(--space-2);
          margin-bottom: var(--space-6);
        }
        
        .passage-slide.hidden { display: none; }

        .mc-question {
          padding: 20px;
          margin-top: var(--space-6);
          border: 1px solid var(--border-sage);
          border-radius: 16px;
          background: linear-gradient(180deg, #ffffff 0%, color-mix(in srgb, #ffffff 92%, var(--warm-cream) 8%));
          box-shadow: var(--shadow-1);
        }

        .mc-question-header { margin-bottom: var(--space-4); }

        .mc-question-text {
          font-weight: 800;
          font-size: var(--step-1);
          color: var(--forest-shadow);
          line-height: 1.45;
        }

        /* Options */
        .mc-options-container {
          display: flex;
          flex-direction: column;
          gap: var(--space-3);
          margin-top: var(--space-4);
        }

        .mc-option-item input { display: none; }

        .mc-option-label {
          display: flex;
          align-items: center;
          gap: var(--space-3);
          cursor: pointer;
          padding: 12px;
          border-radius: 10px;
          border: 1px solid transparent;
          transition: background-color var(--dur-2) var(--ease-ambient), border-color var(--dur-2) var(--ease-ambient), transform var(--dur-1) var(--ease-ambient);
          -webkit-tap-highlight-color: transparent;
          background: #fff;
          border: 1px solid var(--border-sage);
        }

        .mc-option-label:hover { background-color: var(--hover-sage); }

        .mc-option-item .option-control {
          flex-shrink: 0;
          inline-size: 24px;
          block-size: 24px;
          border: 2px solid var(--tertiary-sage);
          background-color: var(--soft-white);
          transition: all var(--dur-2) var(--ease-ambient);
          position: relative;
          border-radius: 50%;
          box-shadow: inset 0 1px 0 rgba(255,255,255,0.7);
        }

        .mc-option-item input[type="radio"]:checked + .option-control { border-color: var(--primary-sage); }

        .mc-option-item input[type="radio"]:checked + .option-control::after {
          content: '';
          position: absolute;
          inset: 50% auto auto 50%;
          transform: translate(-50%, -50%);
          width: 14px;
          height: 14px;
          border-radius: 50%;
          background-color: var(--primary-sage);
          box-shadow: 0 1px 0 rgba(255,255,255,0.4) inset;
        }

        .mc-option-text {
          color: var(--primary-sage);
          line-height: 1.4;
          font-size: 1rem;
        }

        .mc-option-item input[type="radio"]:focus-visible + .option-control,
        .mc-option-label:focus-visible {
          outline: none;
          box-shadow: var(--ring);
        }

        /* Slide controls */
        .mc-slide-student-controls {
          margin-top: var(--space-7);
          display: flex;
          justify-content: space-between;
          gap: var(--space-3);
          flex-wrap: wrap;
        }

        /* -------------------------------
           Submission Screen
        ----------------------------------*/
        .submission-steps { margin-top: var(--space-7); }

        #submission-code {
          width: 100%;
          height: 260px;
          box-sizing: border-box;
          margin: var(--space-3) 0;
          font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace;
          font-size: 0.95rem;
          padding: 12px 14px;
          border: 1px solid var(--tertiary-sage);
          border-radius: 10px;
          background: #fff;
          color: var(--ink);
        }
        
        #submission-controls {
            display: grid;
            gap: var(--space-3);
            grid-auto-flow: row;
            margin-top: var(--space-4);
        }
        
        #submission-status {
            margin-top: var(--space-4);
            font-weight: 700;
            text-align: center;
            min-height: 1.5em;
        }

        /* -------------------------------
           Responsive / container queries
        ----------------------------------*/
        @media (max-width: 360px) {
          #activity-container { padding: 18px; }
          .activity-btn { padding-inline: 14px; }
        }

        @media (min-width: 768px) {
          #app-wrapper { padding-inline: var(--space-7); }
          .controls { grid-auto-flow: column; justify-content: center; }
          #submission-controls { grid-auto-flow: column; justify-content: center; }
          .test-header { grid-template-columns: auto 1fr auto auto; }
        }

        @media (min-width: 1024px) {
          #activity-container { box-shadow: var(--shadow-3); }
          h1 { letter-spacing: 0.3px; }
        }

        @container (min-width: 520px) {
          .mc-question { padding: 24px; }
          .mc-option-label { padding: 14px; }
        }

        @container (min-width: 760px) {
          h1 { font-size: clamp(2rem, 2.2vw + 1rem, 2.75rem); }
          .mc-question-text { font-size: clamp(1.1rem, 0.6vw + 0.9rem, 1.35rem); }
        }

        /* -------------------------------
           Accessibility / motion / scroll
        ----------------------------------*/
        :focus-visible {
          outline: none;
          box-shadow: var(--ring);
        }

        @media (prefers-reduced-motion: reduce) {
          * {
            animation: none !important;
            transition: none !important;
            scroll-behavior: auto !important;
          }
        }

        ::selection {
          background: color-mix(in srgb, var(--secondary-sage) 30%, #fff 70%);
          color: var(--deep-forest);
        }

        html, body { overscroll-behavior-y: none; }

        /* -------------------------------
           Scrollbars (subtle, optional)
        ----------------------------------*/
        *::-webkit-scrollbar {
          width: 10px;
          height: 10px;
        }
        *::-webkit-scrollbar-thumb {
          background: color-mix(in srgb, var(--primary-sage) 50%, var(--tertiary-sage) 50%);
          border-radius: 999px;
          border: 2px solid transparent;
          background-clip: padding-box;
        }
        *::-webkit-scrollbar-track {
          background: transparent;
        }

        /* -------------------------------
           Dark mode (gentle, earthy)
        ----------------------------------*/
        @media (prefers-color-scheme: dark) {
          :root {
            --soft-white: #1E211C;
            --warm-cream: #23261F;
            --forest-shadow: #DDE6D4;
            --ink: #E9EFE5;
            --ink-muted: #AEB9AA;
            --border-sage: rgba(184, 197, 166, 0.25);
          }

          html, body {
            background:
              radial-gradient(1100px 900px at 15% 10%, rgba(156,175,136,0.06), transparent 60%),
              radial-gradient(900px 900px at 85% 90%, rgba(122,132,113,0.08), transparent 65%),
              linear-gradient(135deg, #191D18 0%, #1B1E19 100%);
          }

          #activity-container {
            background: color-mix(in srgb, #23261F 92%, #1B1E19 8%);
            border-color: rgba(184, 197, 166, 0.18);
            box-shadow: 0 12px 36px rgba(0,0,0,0.35);
          }

          a { color: color-mix(in srgb, var(--secondary-sage) 80%, #C7D3C0 20%); }

          .mc-question {
            background: linear-gradient(180deg, #20241E 0%, #191D18 100%);
            border-color: rgba(184, 197, 166, 0.20);
            box-shadow: 0 1px 0 rgba(255,255,255,0.03) inset, 0 10px 30px rgba(0,0,0,0.35);
          }

          .activity-btn {
            background: linear-gradient(180deg, color-mix(in srgb, var(--primary-sage) 80%, #0F120E 20%), var(--primary-sage));
            box-shadow: 0 1px 0 rgba(255,255,255,0.08) inset, 0 8px 18px rgba(0,0,0,0.35);
          }

          .activity-btn:hover {
            background: linear-gradient(180deg, color-mix(in srgb, var(--forest-shadow) 80%, #0F120E 20%), var(--forest-shadow));
          }

          input, textarea, select {
            background: #141713;
            border-color: rgba(184, 197, 166, 0.25);
            color: var(--ink);
          }

          .mc-option-label {
             background: #141713;
             border-color: rgba(184, 197, 166, 0.25);
          }

          #progress-bar {
            background: linear-gradient(90deg, var(--secondary-sage), color-mix(in srgb, var(--primary-sage) 70%, #000 30%));
          }
        }

        /* -------------------------------
           Original responsive tweaks, refined
        ----------------------------------*/
        @media (max-width: 767px) {
          #app-wrapper { padding: var(--space-4); }
          #activity-container { padding: 24px; }
          h1 { font-size: clamp(1.75rem, 5vw, 2rem); }
          h2.rubric { font-size: var(--step--1); margin-bottom: 20px; }
          .mc-question-text { font-size: clamp(1.05rem, 2.6vw, 1.1rem); }
        }
    </style>
</head>
<body>

    <div id="app-wrapper">
        <div id="activity-container">

            <!-- Screen 1: Student ID -->
            <div id="student-id-screen" class="screen">
                <h1>IELTS Reading Practice – A2</h1>
                <h2 class="rubric">Please enter your Student ID to begin.</h2>
                <div class="input-group">
                    <label for="student-id-input" class="visually-hidden">Student ID</label>
                    <input type="text" id="student-id-input" placeholder="Enter your Student ID">
                </div>
                <div class="controls">
                    <button id="student-id-next-btn" class="activity-btn">Next</button>
                </div>
            </div>

            <!-- Screen 2: Level Select -->
            <div id="level-select-screen" class="screen hidden">
                <h1>Confirm Level: A2</h1>
                                <div class="level-buttons">
                    <button class="activity-btn" data-level="A2">A2</button>
                    <button id="level-select-back-btn" class="activity-btn secondary" style="grid-column: 1 / -1; margin-top: var(--space-4);">Go Back</button>
                </div>
            </div>

            <!-- Screen 3: Test Screen -->
            <div id="test-screen" class="screen hidden">
                <div class="test-header">
                    <button id="test-back-btn" class="activity-btn secondary">Return to Start</button>
                    <span id="current-level">Current Level: --</span>
                    <span id="timer">60:00</span>
                </div>
                <div class="progress-bar-container">
                    <div id="progress-bar"></div>
                </div>
                <div id="progress-text">Passage 1 of 3</div>

                                <div id="test-content">
                    <div id="A2-test" class="level-test hidden">
                        <!-- A2 Passage 1 -->
                        <div class="passage-slide" data-passage="1">
                            <h3>Reading Passage 1: Questions 1-13</h3>
                            <h4>An Email About a New Hobby</h4>
                            <p>Hi Alex,</p>
                            <p>How are you? I'm writing to you because I want to tell you about my new hobby. I joined the local photography club! I started three weeks ago.</p>
                            <p>Our club meets every Thursday evening at the community centre. The first meeting was great. We learned about the different parts of a camera. My camera is not very new, but it is good enough to learn with. My teacher says the person taking the photo is more important than the camera.</p>
                            <p>Last week, our meeting was outdoors. We walked around the city centre and took pictures of interesting buildings and people. It was really interesting to look at the city in a new way. I took lots of photos to show you.</p>
                            <p>The people in the club are very friendly. My favourite part is seeing everyone's photos at the end of the week and talking about them. It is the best part of my week so far!</p>
                            <p>I have to go now. I have a club meeting tonight!</p>
                            <p>Speak soon,<br>Chloe</p>
                            
                            <div class="mc-question">
                               <p class="mc-question-header mc-question-text">Questions 1-7: Are the sentences ‘True’, ‘False’ or ‘Not Given’?</p>
                               <div class="mc-options-container">
                                    <p>1. Chloe is writing the email to a family member.</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q1" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q1" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q1" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                                    <p>2. The club meets in the morning.</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q2" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q2" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q2" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                                    <p>3. Chloe has a new and expensive camera.</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q3" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q3" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q3" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                                    <p>4. Chloe enjoyed taking photos in the city.</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q4" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q4" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q4" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                                    <p>5. Last week, the club members took photos of animals.</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q5" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q5" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q5" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                                    <p>6. Chloe does not like the other people in the club.</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q6" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q6" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q6" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                                    <p>7. Chloe thinks the club is the best part of her week.</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q7" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q7" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q7" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                               </div>
                            </div>
                            
                            <div class="mc-question">
                               <p class="mc-question-header mc-question-text">Questions 8-13: Complete the sentences. Write NO MORE THAN TWO WORDS.</p>
                               <p>8. Chloe joined her new club __________ ago. <input type="text" id="A2_q8" name="A2_q8" class="fill-in-blank-input"></p>
                               <p>9. The club meets every week at the __________. <input type="text" id="A2_q9" name="A2_q9" class="fill-in-blank-input"></p>
                               <p>10. The teacher says the __________ is the most important part of photography. <input type="text" id="A2_q10" name="A2_q10" class="fill-in-blank-input"></p>
                               <p>11. Chloe says, ‘I took lots of __________ to show you.’ <input type="text" id="A2_q11" name="A2_q11" class="fill-in-blank-input"></p>
                               <p>12. The other club members are very __________. <input type="text" id="A2_q12" name="A2_q12" class="fill-in-blank-input"></p>
                               <p>13. Chloe’s favourite part is __________ everyone’s photos at the end of the week. <input type="text" id="A2_q13" name="A2_q13" class="fill-in-blank-input"></p>
                            </div>
                        </div>

                        <!-- A2 Passage 2 -->
                        <div class="passage-slide hidden" data-passage="2">
                           <h3>Reading Passage 2: Questions 14-26</h3>
                           <h4>Looking for a Flatmate</h4>
                           <p>My name is Marco and I am looking for a new flatmate. My current flatmate, David, is moving to another city because he found a new job. The room will be available from the 1st of August.</p>
                           <p><b>About the Flat</b><br>The flat is on the third floor of a modern building with an elevator, so you don’t need to worry about stairs. It has two bedrooms, a large living room, a kitchen, and one bathroom which we will share. The available bedroom is not huge, but it is bright and comes furnished with a comfortable bed, a desk for working, and a wardrobe for your clothes. The rent is £500 per month. This price includes the water and internet bills. You will need to pay for electricity and gas separately. This is usually about £40 per person each month. A deposit of £250 is also required.</p>
                           <p><b>About Me</b><br>I am 25 years old and I work as a graphic designer in the city centre. My job is Monday to Friday, 9 am to 5 pm. In my free time, I enjoy relaxing, playing video games, and watching films. I am a quiet and tidy person, so I am looking for someone similar. I don't smoke, and I would much prefer a non-smoker.</p>
                           <p><b>Location</b><br>The flat is in the Easton area. There is a bus stop just outside the building with frequent buses that go to the city centre every 15 minutes. The journey takes about 20 minutes. There is also a large supermarket and a gym within a five-minute walk, which is very convenient.</p>
                           <p>If you are interested, please send me an email at marco.p@email.com. Tell me a little about yourself (your job, hobbies, etc.).</p>

                           <div class="mc-question">
                               <p class="mc-question-header mc-question-text">Questions 14-20: Choose the correct answer A, B, or C.</p>
                               <div class="mc-options-container">
                                    <p>14. Why is Marco looking for a new flatmate?</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q14" value="A"><span class="option-control"></span>A. He wants to move to a new flat.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q14" value="B"><span class="option-control"></span>B. His flat is too big for one person.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q14" value="C"><span class="option-control"></span>C. His current flatmate is leaving for work reasons.</label></div>
                                    
                                    <p>15. The monthly rent of £500 includes...</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q15" value="A"><span class="option-control"></span>A. all bills.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q15" value="B"><span class="option-control"></span>B. water and internet.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q15" value="C"><span class="option-control"></span>C. electricity and gas.</label></div>
                                    
                                    <p>16. The available bedroom contains...</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q16" value="A"><span class="option-control"></span>A. a bed, a desk, and a TV.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q16" value="B"><span class="option-control"></span>B. a desk, a wardrobe, and a bed.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q16" value="C"><span class="option-control"></span>C. a wardrobe, a chair, and a bed.</label></div>
                                    
                                    <p>17. What does Marco say about himself?</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q17" value="A"><span class="option-control"></span>A. He goes to the gym often.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q17" value="B"><span class="option-control"></span>B. He works during the week.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q17" value="C"><span class="option-control"></span>C. He enjoys cooking.</label></div>
                                    
                                    <p>18. Marco is looking for a flatmate who is...</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q18" value="A"><span class="option-control"></span>A. tidy and doesn't smoke.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q18" value="B"><span class="option-control"></span>B. active and likes sports.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q18" value="C"><span class="option-control"></span>C. sociable and likes parties.</label></div>
                                    
                                    <p>19. How long is the bus journey to the city centre?</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q19" value="A"><span class="option-control"></span>A. Five minutes.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q19" value="B"><span class="option-control"></span>B. Fifteen minutes.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q19" value="C"><span class="option-control"></span>C. Twenty minutes.</label></div>

                                    <p>20. What must a person also pay when they move in?</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q20" value="A"><span class="option-control"></span>A. A deposit.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q20" value="B"><span class="option-control"></span>B. The first gas bill.</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q20" value="C"><span class="option-control"></span>C. An agency fee.</label></div>
                               </div>
                           </div>
                           
                           <div class="mc-question">
                               <p class="mc-question-header mc-question-text">Questions 21-26: Answer the questions. Write NO MORE THAN THREE WORDS AND/OR A NUMBER.</p>
                               <div class="input-group"><label for="A2_q21">21. What is the name of Marco's current flatmate?</label><input type="text" id="A2_q21" name="A2_q21"></div>
                               <div class="input-group"><label for="A2_q22">22. On which floor is the flat?</label><input type="text" id="A2_q22" name="A2_q22"></div>
                               <div class="input-group"><label for="A2_q23">23. What is Marco's job?</label><input type="text" id="A2_q23" name="A2_q23"></div>
                               <div class="input-group"><label for="A2_q24">24. What two facilities are a five-minute walk away?</label><input type="text" id="A2_q24" name="A2_q24"></div>
                               <div class="input-group"><label for="A2_q25">25. How often do the buses run to the city centre?</label><input type="text" id="A2_q25" name="A2_q25"></div>
                               <div class="input-group"><label for="A2_q26">26. What should you include in your email to Marco?</label><input type="text" id="A2_q26" name="A2_q26"></div>
                           </div>
                        </div>

                        <!-- A2 Passage 3 -->
                        <div class="passage-slide hidden" data-passage="3">
                           <h3>Reading Passage 3: Questions 27-40</h3>
                           <h4>The Invention of the Bicycle</h4>
                           <p>The bicycle is one of the most popular forms of transport in the world. People use them to travel to work or school, for exercise, or for fun. But who invented it, and why?</p>
                           <p>The history of the bicycle started with a German man named Karl von Drais. In 1817, he invented a "running machine". It was made of wood and had two wheels, but it had no pedals. To move, a person had to push their feet along the ground.</p>
                           <p>In the 1860s, French inventors added pedals to the front wheel. This machine was called the velocipede, but it was very uncomfortable on the stone roads and was called the "boneshaker".</p>
                           <p>Then, in the 1870s, the "high-wheel" bicycle appeared. It had a very big front wheel and a small back wheel. It was faster, but also very dangerous. If the rider hit a small stone, they could easily fall off.</p>
                           <p>The first modern bicycle, called the "safety bicycle", was created in the 1880s. It had two wheels of the same size and a chain to connect the pedals to the back wheel. This design was much safer and more comfortable. This basic idea became very popular in England and then spread all over the world.</p>
                           <p>While many people helped to develop it, the "safety bicycle" was the invention that made cycling popular for everyone. Because of this clever design, we now have a convenient and enjoyable way to travel.</p>

                           <div class="mc-question">
                               <p class="mc-question-header mc-question-text">Questions 27-33: Do the statements agree with the text? Choose True, False, or Not Given.</p>
                               <div class="mc-options-container">
                                    <p>27. The bicycle was invented by one person.</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q27" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q27" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q27" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                                    <p>28. The first "running machine" had pedals.</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q28" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q28" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q28" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                                    <p>29. The "boneshaker" was not comfortable to ride.</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q29" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q29" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q29" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                                    <p>30. The "high-wheel" bicycle was slower than the "boneshaker".</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q30" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q30" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q30" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                                    <p>31. The "high-wheel" bicycle was not very safe.</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q31" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q31" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q31" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                                    <p>32. The "safety bicycle" had two wheels that were different sizes.</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q32" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q32" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q32" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                                    <p>33. The "safety bicycle" first became popular in Germany.</p>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q33" value="True"><span class="option-control"></span>True</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q33" value="False"><span class="option-control"></span>False</label></div>
                                    <div class="mc-option-item"><label class="mc-option-label"><input type="radio" name="A2_q33" value="Not Given"><span class="option-control"></span>Not Given</label></div>
                               </div>
                           </div>
                           
                           <div class="mc-question">
                               <p class="mc-question-header mc-question-text">Questions 34-40: Complete the summary. Write ONE WORD ONLY from the text.</p>
                               <p>The bicycle's history began with a machine that had no (34) <input type="text" id="A2_q34" name="A2_q34" class="fill-in-blank-input">. Later, pedals were added, but the ride was very (35) <input type="text" id="A2_q35" name="A2_q35" class="fill-in-blank-input">. The "high-wheel" bicycle was fast but (36) <input type="text" id="A2_q36" name="A2_q36" class="fill-in-blank-input">. The first modern bicycle was called the "safety bicycle" in the 1880s. It used a (37) <input type="text" id="A2_q37" name="A2_q37" class="fill-in-blank-input"> to power the back wheel. The two wheels were the same (38) <input type="text" id="A2_q38" name="A2_q38" class="fill-in-blank-input">. The new (39) <input type="text" id="A2_q39" name="A2_q39" class="fill-in-blank-input"> was much safer for the rider. Because of this invention, cycling became (40) <input type="text" id="A2_q40" name="A2_q40" class="fill-in-blank-input"> all over the world.</p>
                           </div>
                        </div>
                    </div>
                </div>

                <!-- Universal navigation controls for all tests -->
                <div id="slide-navigation-controls" class="mc-slide-student-controls">
                    <button id="prev-slide-btn" class="activity-btn secondary">Previous</button>
                    <button id="next-slide-btn" class="activity-btn">Next</button>
                </div>

            </div>

            <!-- Screen 4: Submission -->
            <div id="submission-screen" class="screen hidden">
                <h1>Submission</h1>
                <h2 class="rubric">Your test is complete. Please review your answers and choose a submission option below.</h2>
                <textarea id="submission-code" readonly></textarea>
                <div id="submission-controls">
                    <button id="download-csv-btn" class="activity-btn">Download Results as CSV</button>
                    <button id="submit-instructor-btn" class="activity-btn secondary">Submit to Instructor</button>
                    <button id="submission-back-btn" class="activity-btn secondary">Start Over</button>
                </div>
                <div id="submission-status"></div>
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE MANAGEMENT ---
            let studentID = '';
            let currentLevel = '';
            let userAnswers = {};
            let timerInterval;

            // --- GOOGLE SHEETS CONFIG ---
            const GS_WEB_APP_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';

            // --- DOM ELEMENTS ---
            const screens = {
                studentId: document.getElementById('student-id-screen'),
                levelSelect: document.getElementById('level-select-screen'),
                test: document.getElementById('test-screen'),
                submission: document.getElementById('submission-screen'),
            };
            
            const studentIdInput = document.getElementById('student-id-input');
            const studentIdNextBtn = document.getElementById('student-id-next-btn');
            const levelSelectButtons = document.querySelectorAll('.level-buttons .activity-btn');
            
            const currentLevelDisplay = document.getElementById('current-level');
            const timerDisplay = document.getElementById('timer');
            
            const submissionCodeTextarea = document.getElementById('submission-code');
            const downloadCsvBtn = document.getElementById('download-csv-btn');
            const submitInstructorBtn = document.getElementById('submit-instructor-btn');
            const submissionStatus = document.getElementById('submission-status');
            
            const levelSelectBackBtn = document.getElementById('level-select-back-btn');
            const testBackBtn = document.getElementById('test-back-btn');
            const submissionBackBtn = document.getElementById('submission-back-btn');

            // --- FUNCTIONS ---

            function showScreen(screenName) {
                Object.values(screens).forEach(screen => screen.classList.add('hidden'));
                if (screens[screenName]) {
                    screens[screenName].classList.remove('hidden');
                }
            }
            
            function resetApp() {
                clearInterval(timerInterval);
                studentID = '';
                currentLevel = '';
                userAnswers = {};
                studentIdInput.value = '';
                submissionCodeTextarea.value = '';
                submissionStatus.textContent = '';
                submitInstructorBtn.disabled = false;
                
                document.querySelectorAll('.level-test').forEach(test => test.classList.add('hidden'));
                document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
                document.querySelectorAll('input[type="text"]').forEach(text => text.value = '');
                document.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
                
                // Restore original navigation controls if they were replaced
                const slideNavigation = document.getElementById('slide-navigation-controls');
                slideNavigation.innerHTML = `
                    <button id="prev-slide-btn" class="activity-btn secondary">Previous</button>
                    <button id="next-slide-btn" class="activity-btn">Next</button>
                `;

                showScreen('studentId');
            }

            function startTest(level) {
                currentLevel = level;
                userAnswers = {}; // Reset answers
                currentLevelDisplay.textContent = `Current Level: ${level.replace('_plus', '+')}`;
                
                // Hide all level-test containers
                document.querySelectorAll('.level-test').forEach(test => test.classList.add('hidden'));
                
                const selectedTestContainer = document.getElementById(`${level}-test`);
                if (selectedTestContainer) {
                    // Show the entire container for the selected level
                    selectedTestContainer.classList.remove('hidden');
                    
                    // Ensure all passage slides within this container are visible
                    const slides = selectedTestContainer.querySelectorAll('.passage-slide');
                    slides.forEach(slide => slide.classList.remove('hidden'));
                    
                    // Replace slide navigation with a single "Finish Test" button
                    const slideNavigation = document.getElementById('slide-navigation-controls');
                    slideNavigation.innerHTML = '<button id="finish-test-btn" class="activity-btn">Finish Test</button>';
                    document.getElementById('finish-test-btn').addEventListener('click', goToSubmission);
                    
                    // Hide progress bar elements as they are not needed for a single-page view
                    document.querySelector('.progress-bar-container').style.display = 'none';
                    document.getElementById('progress-text').style.display = 'none';

                    startTimer(3600); // 60 minutes
                    showScreen('test');
                } else {
                    console.error(`Test content for level ${level} not found.`);
                    alert(`Error: Test content for level ${level} could not be found.`);
                    showScreen('levelSelect');
                }
            }

            function startTimer(duration) {
                let timer = duration;
                clearInterval(timerInterval);

                timerInterval = setInterval(() => {
                    let minutes = parseInt(timer / 60, 10);
                    let seconds = parseInt(timer % 60, 10);

                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;

                    timerDisplay.textContent = `${minutes}:${seconds}`;

                    if (--timer < 0) {
                        clearInterval(timerInterval);
                        goToSubmission();
                    }
                }, 1000);
            }
            
            function recordAnswer(event) {
                const input = event.target;
                const questionId = input.name;
                const answerValue = input.value;
                if(questionId) {
                    userAnswers[questionId] = answerValue;
                }
            }

            function goToSubmission() {
                clearInterval(timerInterval);
                prepareSubmissionData();
                showScreen('submission');
            }
            
            function prepareSubmissionData() {
                let summaryText = `Student ID: ${studentID}\nLevel: ${currentLevel.replace('_plus', '+')}\n\n--- Answers ---\n`;
                const questionKeys = Object.keys(userAnswers).sort((a, b) => {
                    const numA = parseInt(a.match(/\d+/)[0]);
                    const numB = parseInt(b.match(/\d+/)[0]);
                    return numA - numB;
                });

                questionKeys.forEach(key => {
                    summaryText += `${key}: ${userAnswers[key]}\n`;
                });
                submissionCodeTextarea.value = summaryText;
            }

            function downloadCSV() {
                const headers = ['Level', 'QuestionNumber', 'StudentAnswer'];
                let csvContent = "data:text/csv;charset=utf-8," + headers.join(',') + '\n';

                const questionKeys = Object.keys(userAnswers).sort((a, b) => {
                    const numA = parseInt(a.match(/\d+/)[0]);
                    const numB = parseInt(b.match(/\d+/)[0]);
                    return numA - numB;
                });
                
                questionKeys.forEach(key => {
                    const row = [currentLevel.replace('_plus', '+'), key, `"${userAnswers[key]}"`];
                    csvContent += row.join(',') + '\n';
                });
                
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `${studentID}_IELTS_Results.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            async function submitToGoogleSheet() {
                 if (GS_WEB_APP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                    submissionStatus.textContent = "Error: Google Apps Script URL is not configured.";
                    submissionStatus.style.color = 'red';
                    return;
                }

                submissionStatus.textContent = 'Submitting...';
                submissionStatus.style.color = 'var(--secondary-sage)';
                submitInstructorBtn.disabled = true;

                const data = {
                    studentID: studentID,
                    level: currentLevel,
                    answers: userAnswers,
                };

                try {
                    const response = await fetch(GS_WEB_APP_URL, {
                        method: 'POST',
                        mode: 'no-cors', 
                        cache: 'no-cache',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data),
                        redirect: 'follow',
                    });
                    
                    submissionStatus.textContent = "Successfully submitted!";
                    submissionStatus.style.color = 'green';

                } catch (error) {
                    console.error('Error:', error);
                    submissionStatus.textContent = `Error: Could not submit. ${error.message}`;
                    submissionStatus.style.color = 'red';
                    submitInstructorBtn.disabled = false;
                }
            }

            // --- EVENT LISTENERS ---

            studentIdNextBtn.addEventListener('click', () => {
                const id = studentIdInput.value.trim();
                if (id) {
                    studentID = id;
                    showScreen('levelSelect');
                } else {
                    alert('Please enter a Student ID.');
                }
            });

            levelSelectButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const level = button.getAttribute('data-level');
                    if (level) {
                       startTest(level);
                    }
                });
            });
            
            document.getElementById('test-content').addEventListener('change', recordAnswer);
            document.getElementById('test-content').addEventListener('input', recordAnswer); // For text fields
            
            downloadCsvBtn.addEventListener('click', downloadCSV);
            submitInstructorBtn.addEventListener('click', submitToGoogleSheet);
            
            // Back button listeners
            levelSelectBackBtn.addEventListener('click', () => showScreen('studentId'));
            testBackBtn.addEventListener('click', resetApp);
            submissionBackBtn.addEventListener('click', resetApp);
            
            // --- INITIALIZATION ---
            showScreen('studentId');
        });
    </script>
</body>
</html>